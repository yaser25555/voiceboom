// لا تحتاج للتحقق من if (loginForm) هنا لأنك تحصل عليه في بداية DOMContentLoaded
loginForm.addEventListener('submit', async (e) => { // تغيير من loginButton.addEventListener('click', ...
    e.preventDefault(); // هذا السطر ضروري لمنع إعادة تحميل الصفحة عند تقديم النموذج

    const username = loginUsernameInput.value;
    const password = loginPasswordInput.value;

    if (!username || !password) {
        loginErrorMessage.textContent = 'الرجاء إدخال اسم المستخدم/البريد الإلكتروني وكلمة المرور.';
        return;
    }

    loginErrorMessage.textContent = ''; // مسح أي رسائل خطأ سابقة

    try {
        const response = await fetch('https://voiceboom-wlxp.onrender.com/api/auth/login', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ username, password })
        });

        const data = await response.json();

        if (response.ok) {
            localStorage.setItem('token', data.token);
            localStorage.setItem('username', data.username);
            localStorage.setItem('isAdmin', data.isAdmin);

            window.location.href = 'game.html';
        } else {
            loginErrorMessage.textContent = data.message || 'فشل تسجيل الدخول. الرجاء التحقق من اسم المستخدم وكلمة المرور.';
        }
    } catch (error) {
        console.error('Error during login:', error);
        loginErrorMessage.textContent = 'حدث خطأ غير متوقع. الرجاء المحاولة مرة أخرى لاحقاً.';
    }
});